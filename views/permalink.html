{% extends "base.html" %}

{% block content %}

{% if post_deleted %}
    <span class="error">Post deleted</span>
{% else %}
    {{post.render() | safe}}
    <!-- show action form button if user == author of the post -->
    <form id="actions" method="post">
    {% if user == post.parent().username %}

            <input type="submit" name="action" value="Edit">
            <input type="submit" name="action" value="Delete">

        {% endif %}
            {% if action == 'Delete' %}
                <span class="error">Confirm post deletion</span>
                <input type="submit" name="action_delete" value="Confirm">
                <input type="submit" name="action_cancel" value="Cancel">


    {% endif %}
    </form>

    <!-- comments block -->
    <h3 class="comments-title">
        {{comment_count}} comments
    </h3>
    <input form="actions" type="submit" name="action" value="Add comment">
    <!-- add comment form -->
    {% if act == 'Add comment' %}
        {% if user %}
            <label>
              <div  class="">Comment text</div>

              <textarea id="id_0" form="actions"
                        class="textarea" name="content">{{content}}</textarea>
                <div class="error">
                  {{error}}
                </div>
            </label>

            <!-- comment_id from post response to edit the comment-->
            <input form="actions" type="hidden"
                   name="comment_id" value="">
            <input form="actions" type="submit"
                   name="action" value="Submit comment">
            <input form="actions" type="submit"
                   name="action_cancel" value="Cancel">
       {% else %}
       <div class="error">
         Please, <a href="/blog/login">login</a> to write a comment
       </div>
       {% endif %}
    {% endif %}

    {% if comments %}

        {%for comment in comments%}
            {{ comment.render() | safe }}
            {% if comment.author == user %}
            <input form="actions" type="hidden"
                   name="comment_id" value="{{comment.key()}}">
            <input form="actions" type="submit"
                   name="action" value="Edit comment">
            <input form="actions" type="submit"
                   name="action" value="Delete comment">
            {% endif %}
        {% endfor %}
    {% endif %}

{% endif %}

{% endblock %}
